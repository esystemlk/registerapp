import{b as w,u as y,a as v,r,w as N,x as k,y as d,z as C,j as e,A as f,m as I,n as S,o as D,p as A,k as c}from"./index-BpwiqXsp.js";import{B as p,C as $,d as B}from"./card-DYsbf8uQ.js";import{I as E}from"./input-DoI17m8q.js";import{A as F}from"./arrow-left-Dr6MJ2FG.js";import"./createLucideIcon-DNKxwa87.js";function L(){const{bookingId:i}=w(),{user:a}=y(),x=v(),[g,j]=r.useState([]),[l,m]=r.useState(""),h=r.useRef(null);r.useEffect(()=>{if(!a){x("/login");return}const s=N(d(c,"bookings",i,"messages"),k("at","asc")),t=C(s,n=>{j(n.docs.map(o=>({id:o.id,...o.data()}))),setTimeout(()=>{var o;return(o=h.current)==null?void 0:o.scrollIntoView({behavior:"smooth"})},50)});return()=>t()},[i,a]);const u=async()=>{l.trim()&&(await f(d(c,"bookings",i,"messages"),{senderId:a==null?void 0:a.id,text:l,at:new Date().toISOString()}),m(""))},b=async s=>{const t=I(S,`chat/${i}/${Date.now()}-${s.name}`);await D(t,s);const n=await A(t);await f(d(c,"bookings",i,"messages"),{senderId:a==null?void 0:a.id,fileUrl:n,at:new Date().toISOString()})};return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"sticky top-0 z-10 shadow-sm",style:{backgroundColor:"#0066FF"},children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>x(-1),className:"text-white hover:bg-white/20",children:e.jsx(F,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-white font-semibold",children:"Chat"})]})})}),e.jsx("div",{className:"max-w-3xl mx-auto px-4 py-4",children:e.jsx($,{children:e.jsxs(B,{className:"p-4",children:[e.jsxs("div",{className:"space-y-2 max-h-[60vh] overflow-auto",children:[g.map(s=>e.jsx("div",{className:`flex ${s.senderId===(a==null?void 0:a.id)?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`px-3 py-2 rounded-xl ${s.senderId===(a==null?void 0:a.id)?"bg-blue-600 text-white":"bg-white/80 border"}`,children:[s.text&&e.jsx("div",{children:s.text}),s.fileUrl&&e.jsx("a",{href:s.fileUrl,target:"_blank",className:"underline text-sm",children:"Attachment"})]})},s.id)),e.jsx("div",{ref:h})]}),e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx(E,{value:l,onChange:s=>m(s.target.value),placeholder:"Type a message...",onKeyDown:s=>{s.key==="Enter"&&u()}}),e.jsxs("label",{className:"px-3 py-2 border rounded-lg bg-white/60 backdrop-blur cursor-pointer",children:["File",e.jsx("input",{type:"file",className:"hidden",onChange:s=>{var n;const t=(n=s.target.files)==null?void 0:n[0];t&&b(t)}})]}),e.jsx(p,{onClick:u,children:"Send"})]})]})})})]})}export{L as default};
