import{u as z,a as Q,r as o,L as W,I,J as $,j as e,B as X,t as v,M as G,N as B,O,P as q,H as Z,g as ee}from"./index-B4Ad_25t.js";import{C as ae,a as se,b as te,d as le}from"./card-CoGWnkv-.js";import{L as c}from"./label-CKOw0SqW.js";import{I as y}from"./input-Bp-9N0Nk.js";import{R as M,a as x}from"./radio-group-CEsQC9ue.js";import"./index-oQduYenF.js";import"./index-i2ZupbD7.js";import"./index-9O4Fc58M.js";import"./index-DiL10ndF.js";import"./createLucideIcon-BGnTon0B.js";function ge(){const{user:d}=z(),w=Q(),[N,b]=o.useState(""),[m,p]=o.useState([]),[i,f]=o.useState(null),[g,C]=o.useState(""),[S,E]=o.useState(""),[A,L]=o.useState("STUDENT"),[V,_]=o.useState(!0),[R,j]=o.useState(null),[k,F]=o.useState(""),[T,H]=o.useState(null),[P,J]=o.useState(null),[D,K]=o.useState(null),[re,ne]=o.useState([]);o.useEffect(()=>{if(!d){w("/login");return}const s=async()=>{j(null);try{const r=await fetch("https://restcountries.com/v3.1/all?fields=name,cca2,idd");if(!r.ok)throw new Error("countries v3.1 failed");let l=(await r.json()).filter(a=>{var n,u,h,U;return((n=a.name)==null?void 0:n.common)&&a.cca2&&((u=a.idd)==null?void 0:u.root)&&((U=(h=a.idd)==null?void 0:h.suffixes)==null?void 0:U.length)}).map(a=>({name:a.name.common,code:a.cca2,dial:`${a.idd.root}${a.idd.suffixes[0]}`}));if(!l.length)throw new Error("empty map");l=l.sort((a,n)=>a.name.localeCompare(n.name)),p(l);return}catch{}try{const r=await fetch("https://restcountries.com/v2/all?fields=name,alpha2Code,callingCodes");if(!r.ok)throw new Error("countries v2 failed");let l=(await r.json()).filter(a=>a.name&&a.alpha2Code&&Array.isArray(a.callingCodes)&&a.callingCodes[0]).map(a=>({name:a.name,code:a.alpha2Code,dial:`+${a.callingCodes[0]}`}));l=l.sort((a,n)=>a.name.localeCompare(n.name)),p(l);return}catch{j("Unable to load countries. Check your connection and try again."),p([])}};(async()=>{await s();try{const r=await W(I($,"users",d.id));if(r.exists()){const t=r.data();b(t.name||d.name||""),t.countryCode&&t.countryName&&t.phoneCode&&f({name:t.countryName,code:t.countryCode,dial:t.phoneCode}),C(t.phoneRaw||""),E(t.gender||""),L(t.lecturerApplicant?"LECTURER_APPLICANT":"STUDENT"),F(t.bio||""),K(t.avatarUrl||null)}}finally{_(!1)}})()},[d]);const Y=async s=>{if(s.preventDefault(),!d)return;if(!i){v.error("Select a country");return}const r=`${i.dial}${g.replace(/\D/g,"")}`;try{let t;if(T){const n=G(B,`avatars/${d.id}.jpg`);await O(n,T),t=await q(n)}const l=[],a=document.getElementById("kyc-input");if(a!=null&&a.files&&a.files.length)for(const n of Array.from(a.files)){const u=G(B,`kyc/${d.id}/${Date.now()}-${n.name}`);await O(u,n),l.push(await q(u))}await Z(I($,"users",d.id),{name:N,email:d.email,role:"STUDENT",countryCode:i.code,countryName:i.name,phoneCode:i.dial,phoneE164:r,phoneRaw:g,gender:S,bio:k,...t?{avatarUrl:t}:{},...l.length?{kycFiles:l,kycStatus:"PENDING"}:{},lecturerApplicant:A==="LECTURER_APPLICANT",onboardingComplete:!0,updatedAt:new Date().toISOString()},{merge:!0}),v.success("Profile saved"),w(ee("STUDENT"))}catch(t){v.error((t==null?void 0:t.message)||"Failed to save profile")}};return V?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:"Loading…"}):e.jsx("div",{className:"min-h-screen flex items-center justify-center p-3 sm:p-4",style:{backgroundColor:"#ffffff"},children:e.jsxs(ae,{className:"w-full max-w-2xl shadow-lg",children:[e.jsx(se,{children:e.jsx(te,{style:{color:"#0066FF"},children:"Complete Your Profile"})}),e.jsx(le,{children:e.jsxs("form",{className:"space-y-4",onSubmit:Y,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 sm:w-16 sm:h-16 rounded-full overflow-hidden border border-white/50 bg-white/60 backdrop-blur",children:P?e.jsx("img",{src:P,className:"w-full h-full object-cover"}):D?e.jsx("img",{src:D,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-sm text-gray-500",children:"No photo"})}),e.jsxs("div",{className:"w-full sm:w-auto",children:[e.jsxs("label",{className:"inline-flex items-center gap-2 px-3 py-2 rounded-lg border border-white/50 bg-white/40 backdrop-blur cursor-pointer w-full sm:w-auto justify-center",children:[e.jsx("span",{children:"Upload Photo"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:s=>{var t;const r=((t=s.target.files)==null?void 0:t[0])||null;H(r),J(r?URL.createObjectURL(r):null)}})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:"JPG/PNG, square works best"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Full Name"}),e.jsx(y,{value:N,onChange:s=>b(s.target.value),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Email"}),e.jsx(y,{value:(d==null?void 0:d.email)||"",disabled:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Bio"}),e.jsx("textarea",{className:"w-full min-h-24 rounded-lg border border-white/50 bg-white/60 backdrop-blur px-3 py-2 text-sm",placeholder:"Tell us about yourself",value:k,onChange:s=>F(s.target.value)})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Lecturer Verification (Optional)"}),e.jsx("p",{className:"text-xs text-gray-600",children:"If you plan to teach, upload ID/certificates for admin verification."}),e.jsx("input",{id:"kyc-input",type:"file",multiple:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Country"}),e.jsxs("select",{className:"w-full border rounded px-2 py-2 bg-white/60 backdrop-blur border-white/50 rounded-lg",value:(i==null?void 0:i.code)||"",onChange:s=>{const r=m.find(t=>t.code===s.target.value)||null;f(r)},required:!0,children:[e.jsx("option",{value:"",children:m.length?"Select country":R||"Loading countries…"}),m.map(s=>e.jsxs("option",{value:s.code,children:[s.name," (",s.dial,")"]},s.code))]}),R&&e.jsx("button",{type:"button",className:"text-xs underline text-blue-700 mt-1",onClick:async()=>{try{const t=(await(await fetch("https://restcountries.com/v3.1/all?fields=name,cca2,idd")).json()).filter(l=>{var a,n,u,h;return((a=l.name)==null?void 0:a.common)&&l.cca2&&((n=l.idd)==null?void 0:n.root)&&((h=(u=l.idd)==null?void 0:u.suffixes)==null?void 0:h.length)}).map(l=>({name:l.name.common,code:l.cca2,dial:`${l.idd.root}${l.idd.suffixes[0]}`})).sort((l,a)=>l.name.localeCompare(a.name));p(t),j(null)}catch{}},children:"Retry loading countries"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Code"}),e.jsxs("select",{className:"w-full border rounded px-2 py-2 bg-white/60 backdrop-blur border-white/50 rounded-lg",value:(i==null?void 0:i.dial)||"",onChange:s=>{const r=m.find(t=>t.dial===s.target.value)||null;f(r)},children:[e.jsx("option",{value:"",children:m.length?"Select code":"—"}),m.map(s=>e.jsxs("option",{value:s.dial,children:[s.dial," — ",s.name]},`${s.code}-${s.dial}`))]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Phone"}),e.jsxs("div",{className:"flex",children:[e.jsx("span",{className:"inline-flex items-center px-3 border rounded-l bg-gray-50 text-sm text-gray-600 overflow-hidden",children:(i==null?void 0:i.dial)||"+.."}),e.jsx(y,{className:"rounded-l-none",value:g,onChange:s=>C(s.target.value),placeholder:"123456789",required:!0})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Gender"}),e.jsx(M,{value:S,onValueChange:s=>E(s),children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{id:"male",value:"MALE"}),e.jsx(c,{htmlFor:"male",children:"Male"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{id:"female",value:"FEMALE"}),e.jsx(c,{htmlFor:"female",children:"Female"})]})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"Register As"}),e.jsx(M,{value:A,onValueChange:s=>L(s),children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{id:"student",value:"STUDENT"}),e.jsx(c,{htmlFor:"student",children:"Student"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{id:"lecturerApplicant",value:"LECTURER_APPLICANT"}),e.jsx(c,{htmlFor:"lecturerApplicant",children:"I am a Lecturer (contact me)"})]})]})})]}),e.jsx(X,{type:"submit",className:"w-full text-white",style:{backgroundColor:"#0066FF"},children:"Save and Continue"})]})})]})})}export{ge as default};
