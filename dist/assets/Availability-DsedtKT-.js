import{r as c,c as K,j as e,d as B,u as Q,a as V,B as F,t as j}from"./index-29trkLDX.js";import{C as R,d as D,a as W,b as _}from"./card-WBB6GQn7.js";import{u as Z,c as ee,a as te}from"./index-aoTNzHMW.js";import{u as ae,a as se}from"./index-BaLXfkNy.js";import{P as $}from"./index--ESsa993.js";import{L as re}from"./label-C8eofHuj.js";import{e as le,s as ne,f as oe,p as ce}from"./db-DRhg_JvH.js";import{f as ie}from"./calendar-CpbuF6B_.js";import{A as de}from"./arrow-left-DOABcHRX.js";import{C as ue}from"./calendar-_2YOwdHT.js";import{C as he}from"./circle-alert-DnE59jz4.js";import{C as me}from"./check-BwZctonS.js";import"./createLucideIcon-D2ca4Kpj.js";var L="Switch",[pe]=te(L),[fe,be]=pe(L),H=c.forwardRef((a,i)=>{const{__scopeSwitch:l,name:u,checked:n,defaultChecked:b,required:h,disabled:m,value:p="on",onCheckedChange:x,form:y,...g}=a,[o,k]=c.useState(null),N=K(i,C=>k(C)),w=c.useRef(!1),S=o?y||!!o.closest("form"):!0,[v=!1,M]=Z({prop:n,defaultProp:b,onChange:x});return e.jsxs(fe,{scope:l,checked:v,disabled:m,children:[e.jsx($.button,{type:"button",role:"switch","aria-checked":v,"aria-required":h,"data-state":q(v),"data-disabled":m?"":void 0,disabled:m,value:p,...g,ref:N,onClick:ee(a.onClick,C=>{M(t=>!t),S&&(w.current=C.isPropagationStopped(),w.current||C.stopPropagation())})}),S&&e.jsx(xe,{control:o,bubbles:!w.current,name:u,value:p,checked:v,required:h,disabled:m,form:y,style:{transform:"translateX(-100%)"}})]})});H.displayName=L;var G="SwitchThumb",Y=c.forwardRef((a,i)=>{const{__scopeSwitch:l,...u}=a,n=be(G,l);return e.jsx($.span,{"data-state":q(n.checked),"data-disabled":n.disabled?"":void 0,...u,ref:i})});Y.displayName=G;var xe=a=>{const{control:i,checked:l,bubbles:u=!0,...n}=a,b=c.useRef(null),h=ae(l),m=se(i);return c.useEffect(()=>{const p=b.current,x=window.HTMLInputElement.prototype,g=Object.getOwnPropertyDescriptor(x,"checked").set;if(h!==l&&g){const o=new Event("click",{bubbles:u});g.call(p,l),p.dispatchEvent(o)}},[h,l,u]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...n,tabIndex:-1,ref:b,style:{...a.style,...m,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function q(a){return a?"checked":"unchecked"}var ye=H,ge=Y;function ve({className:a,...i}){return e.jsx(ye,{"data-slot":"switch",className:B("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-switch-background focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",a),...i,children:e.jsx(ge,{"data-slot":"switch-thumb",className:B("bg-card dark:data-[state=unchecked]:bg-card-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function Te(){const{user:a}=Q(),i=V(),[l,u]=c.useState(null),[n,b]=c.useState(""),[h,m]=c.useState([]),[p,x]=c.useState(!1),[y,g]=c.useState(14);c.useEffect(()=>{(!a||a.role!=="LECTURER")&&i("/login"),a!=null&&a.id&&le(a.id).then(t=>{t&&(u(t.id),t.calendarIcsUrl&&b(t.calendarIcsUrl))})},[a,i]);const o=["09:00 AM","10:00 AM","11:00 AM","12:00 PM","01:00 PM","02:00 PM","03:00 PM","04:00 PM","05:00 PM"],[k,N]=c.useState([{day:"Monday",enabled:!0,slots:o.map(t=>({time:t,enabled:!0}))},{day:"Tuesday",enabled:!0,slots:o.map(t=>({time:t,enabled:!1}))},{day:"Wednesday",enabled:!0,slots:o.map(t=>({time:t,enabled:!0}))},{day:"Thursday",enabled:!1,slots:o.map(t=>({time:t,enabled:!1}))},{day:"Friday",enabled:!0,slots:o.map(t=>({time:t,enabled:!0}))},{day:"Saturday",enabled:!1,slots:o.map(t=>({time:t,enabled:!1}))},{day:"Sunday",enabled:!1,slots:o.map(t=>({time:t,enabled:!1}))}]),w=t=>{N(s=>{const r=[...s];return r[t].enabled=!r[t].enabled,r})},S=(t,s)=>{N(r=>{const d=[...r];return d[t].slots[s].enabled=!d[t].slots[s].enabled,d})},v=t=>{const[s,r,d]=t.split(/[: ]/);let f=parseInt(s,10)%12;return d==="PM"&&(f+=12),`${String(f).padStart(2,"0")}:${r}`},M=async()=>{if(l&&n&&n.startsWith("http"))try{await ne(l,n)}catch{}if(l){const t={};for(const s of k)s.enabled&&(t[s.day]=s.slots.filter(r=>r.enabled).map(r=>v(r.time)));try{await oe(l,t),await ce(l,Math.max(1,Math.min(60,y||14)))}catch{}}h.length&&j.warning(`Conflicts detected with your calendar: ${h.length} busy events in next 7 days. Slots that overlap should not be published.`),j.success("Availability updated successfully!"),i("/lecturer/dashboard")},C=async()=>{if(!n||!n.startsWith("http")){j.error("Enter a valid public ICS URL from your Google Calendar settings");return}x(!0);try{const t=await ie(n);m(t);const s=new Date,r=[...Array(7)].map((f,A)=>new Date(s.getFullYear(),s.getMonth(),s.getDate()+A));let d=0;for(const f of r){const A=f.toLocaleDateString("en-US",{weekday:"long"}),T=k.find(P=>P.day===A&&P.enabled);if(T)for(const P of T.slots.filter(E=>E.enabled)){const[E,O,X]=P.time.split(/[: ]/);let U=parseInt(E,10)%12;X==="PM"&&(U+=12);const I=new Date(f.getFullYear(),f.getMonth(),f.getDate(),U,parseInt(O,10)),J=new Date(I.getTime()+3600*1e3);t.some(z=>z.end>I&&z.start<J)&&d++}}j.message("Double-booking check",{description:`${d} slot(s) overlap your Google Calendar in the next 7 days.`})}catch(t){j.error((t==null?void 0:t.message)||"Failed to read ICS feed")}finally{x(!1)}};return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"sticky top-0 z-10 shadow-sm",style:{backgroundColor:"#0066FF"},children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(F,{variant:"ghost",size:"sm",onClick:()=>i("/lecturer/dashboard"),className:"text-white hover:bg-white/20",children:e.jsx(de,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-white font-semibold",children:"Set Availability"})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsx(R,{className:"mb-6",style:{backgroundColor:"#f0f7ff",borderColor:"#0066FF"},children:e.jsx(D,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ue,{className:"w-5 h-5 mt-0.5",style:{color:"#0066FF"}}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",style:{color:"#0066FF"},children:"Configure Your Schedule"}),e.jsx("p",{className:"text-xs text-gray-600 mt-1",children:"Enable days and select time slots when you're available for classes. Students can only book during these times."})]})]})})}),e.jsxs(R,{className:"mb-6",children:[e.jsx(W,{children:e.jsxs(_,{className:"flex items-center gap-2",children:[e.jsx(he,{className:"w-4 h-4",style:{color:"#0066FF"}}),"Avoid Double-booking"]})}),e.jsxs(D,{className:"space-y-2",children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Paste your Google Calendar public ICS URL. We’ll check the next 7 days for conflicts when you save."}),l&&void 0,e.jsx("input",{className:"border rounded px-3 py-2 w-full",placeholder:"https://calendar.google.com/calendar/ical/.../basic.ics",value:n,onChange:t=>b(t.target.value)}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Publish days"}),e.jsx("input",{type:"number",min:1,max:60,value:y,onChange:t=>g(parseInt(t.target.value||"14",10)),className:"border rounded px-2 py-1 w-24"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Range for generated availability (max 60)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(F,{variant:"outline",onClick:C,disabled:p,children:p?"Checking…":"Check Conflicts"}),e.jsx("span",{className:"text-xs text-gray-500",children:"We don’t modify your calendar."})]})]})]}),e.jsx("div",{className:"space-y-4",children:k.map((t,s)=>e.jsxs(R,{children:[e.jsx(W,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{className:"text-lg",children:t.day}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{htmlFor:`day-${s}`,className:"text-sm text-gray-600",children:t.enabled?"Available":"Not Available"}),e.jsx(ve,{id:`day-${s}`,checked:t.enabled,onCheckedChange:()=>w(s)})]})]})}),t.enabled&&e.jsx(D,{children:e.jsx("div",{className:"grid grid-cols-3 gap-2",children:t.slots.map((r,d)=>e.jsxs(F,{variant:r.enabled?"default":"outline",size:"sm",className:"text-xs",style:r.enabled?{backgroundColor:"#0066FF",color:"white"}:{},onClick:()=>S(s,d),children:[r.enabled&&e.jsx(me,{className:"w-3 h-3 mr-1"}),r.time]},r.time))})})]},t.day))}),e.jsx("div",{className:"sticky bottom-0 pt-6 pb-6",style:{backgroundColor:"#f8f9fa"},children:e.jsx(F,{className:"w-full h-12 text-white text-lg",style:{backgroundColor:"#0066FF"},onClick:M,children:"Save Availability"})})]})]})}export{Te as default};
