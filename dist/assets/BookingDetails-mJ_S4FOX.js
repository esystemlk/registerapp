import{b as S,u as B,a as E,r as l,j as e,B as c,t as h}from"./index-BqEl7Wkh.js";import{o as L,q as R,a as A,c as F}from"./db-DFw_BVXj.js";import{C as p,a as b,b as v,d as y}from"./card-Bdt5gLys.js";import{B as O}from"./badge-CukKXGJV.js";import{b as z}from"./calendar-CpbuF6B_.js";import{A as U}from"./arrow-left-C3WHgRIn.js";import{C as $}from"./calendar-C28yHPrz.js";import{C as M}from"./clock-BZjs3VgR.js";import{D as P}from"./dollar-sign-_vtkuArg.js";import"./createLucideIcon-CsiBHQA2.js";function Y(){const{id:o}=S(),{user:x}=B(),u=E(),[a,f]=l.useState(null),[j,N]=l.useState([]),[C,d]=l.useState(!1),[g,k]=l.useState([]),[t,m]=l.useState(null);l.useEffect(()=>{x||u("/login")},[x]),l.useEffect(()=>{o&&(L(o).then(s=>f(s)),R(o).then(N))},[o]);const w=s=>{switch(s){case"CONFIRMED":return{backgroundColor:"#10b981",color:"white"};case"PENDING":return{backgroundColor:"#FFD700",color:"#000"};case"CANCELLED":return{backgroundColor:"#ef4444",color:"white"};default:return{}}},I=async()=>{if(a)try{const s=await A(a.lecturerId),r=[];s.forEach(i=>(i.timeSlots||[]).forEach(n=>{n.available&&r.push({availabilityId:i.id,date:i.date,slotId:n.id,time:n.time||n.id})})),k(r),d(!0)}catch(s){h.error((s==null?void 0:s.message)||"Failed to load availability")}},D=async()=>{if(!(!a||!t))try{await F(a.id,a.availabilityId||null,a.slotId||null,t.availabilityId,t.slotId,t.date,t.time),f({...a,date:t.date,time:t.time,availabilityId:t.availabilityId,slotId:t.slotId,status:"CONFIRMED"}),d(!1),m(null),h.success("Booking rescheduled")}catch(s){h.error((s==null?void 0:s.message)||"Reschedule failed")}};return a?e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"sticky top-0 z-10 shadow-sm",style:{backgroundColor:"#0066FF"},children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>u("/student/bookings"),className:"text-white hover:bg-white/20",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-white font-semibold",children:"Booking Details"})]})})}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 py-6 space-y-6",children:[e.jsxs(p,{children:[e.jsx(b,{children:e.jsxs(v,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:[a.subject," with ",a.lecturerName]}),e.jsx(O,{style:w(a.status),children:a.status})]})}),e.jsxs(y,{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"})," ",new Date(a.date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4"})," ",a.time]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4"})," $",a.price]}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{const s=z(a),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=`booking-${a.id}.ics`,i.click(),URL.revokeObjectURL(r)},children:"Add to Calendar"}),e.jsx(c,{size:"sm",onClick:I,children:"Reschedule"})]})]})]}),e.jsxs(p,{children:[e.jsx(b,{children:e.jsx(v,{children:"Activity"})}),e.jsx(y,{children:e.jsx("ul",{className:"space-y-2",children:j.length?j.map(s=>e.jsxs("li",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.type}),e.jsxs("span",{className:"text-gray-500",children:[" — ",new Date(s.at).toLocaleString()]})]},s.id)):e.jsx("li",{className:"text-sm text-gray-500",children:"No activity yet."})})})]})]}),C&&e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",style:{color:"#0066FF"},children:"Choose a new available slot"}),e.jsx("div",{className:"max-h-64 overflow-auto border rounded-lg",children:g.length?e.jsx("ul",{children:g.map(s=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:"slot",checked:(t==null?void 0:t.availabilityId)===s.availabilityId&&(t==null?void 0:t.slotId)===s.slotId,onChange:()=>m(s)}),e.jsxs("span",{children:[new Date(s.date).toLocaleDateString()," — ",s.time]})]})},`${s.availabilityId}-${s.slotId}`))}):e.jsx("div",{className:"p-3 text-sm text-gray-600",children:"No free slots available for this lecturer."})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsx(c,{variant:"outline",onClick:()=>{d(!1),m(null)},children:"Cancel"}),e.jsx(c,{onClick:D,disabled:!t,children:"Confirm"})]})]})})]}):e.jsx("div",{className:"p-6",children:"Loading booking…"})}export{Y as default};
