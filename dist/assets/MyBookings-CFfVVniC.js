import{u as L,a as R,r as d,j as e,B as c,t as f}from"./index-29trkLDX.js";import{b as A,c as T,a as P}from"./db-DRhg_JvH.js";import{C as g,d as N}from"./card-WBB6GQn7.js";import{B as k}from"./badge-BnKgLRNG.js";import{T as M,a as U,b as D,c as F}from"./tabs-CsATiU_f.js";import{b as z}from"./calendar-CpbuF6B_.js";import{A as O}from"./arrow-left-DOABcHRX.js";import{C as h}from"./calendar-_2YOwdHT.js";import{C as $}from"./clock-D3D33bRm.js";import{D as V}from"./dollar-sign-DA27Zz4u.js";import{C as G}from"./credit-card-Dc-DNFDJ.js";import{F as J}from"./file-text-2jUWd2ng.js";import"./index-aoTNzHMW.js";import"./index-Due8Zo6c.js";import"./index--ESsa993.js";import"./createLucideIcon-D2ca4Kpj.js";function ce(){const{user:l}=L(),n=R();d.useEffect(()=>{l||n("/login")},[l,n]);const[y,v]=d.useState([]);d.useEffect(()=>{l!=null&&l.id&&A(l.id).then(v)},[l==null?void 0:l.id]);const x=y.filter(s=>new Date(s.date)>=new Date&&s.status!=="CANCELLED"),u=y.filter(s=>new Date(s.date)<new Date||s.status==="CANCELLED"),I=s=>{switch(s){case"CONFIRMED":return{backgroundColor:"#10b981",color:"white"};case"PENDING":return{backgroundColor:"#FFD700",color:"#000"};case"CANCELLED":return{backgroundColor:"#ef4444",color:"white"};default:return{}}},E=s=>{switch(s){case"APPROVED":return{backgroundColor:"#10b981",color:"white"};case"PENDING":return{backgroundColor:"#FFD700",color:"#000"};case"REJECTED":return{backgroundColor:"#ef4444",color:"white"};default:return{}}},[i,j]=d.useState(null),[b,C]=d.useState([]),[a,p]=d.useState(null),S=async s=>{j(s);try{const t=await P(s.lecturerId),m=[];t.forEach(o=>{(o.timeSlots||[]).forEach(r=>{r.available&&m.push({availabilityId:o.id,date:o.date,slotId:r.id,time:r.time||r.id})})}),C(m)}catch(t){f.error((t==null?void 0:t.message)||"Failed to load availability")}},B=async()=>{if(!(!i||!a))try{await T(i.id,i.availabilityId||null,i.slotId||null,a.availabilityId,a.slotId,a.date,a.time),f.success("Booking rescheduled"),v(s=>s.map(t=>t.id===i.id?{...t,date:a.date,time:a.time,availabilityId:a.availabilityId,slotId:a.slotId,status:"CONFIRMED"}:t)),j(null),p(null),C([])}catch(s){f.error((s==null?void 0:s.message)||"Reschedule failed")}},w=({booking:s,isPast:t=!1})=>e.jsx(g,{className:t?"opacity-75":"",children:e.jsx(N,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg flex items-center justify-center",style:{backgroundColor:"#f0f7ff"},children:e.jsx(h,{className:"w-8 h-8",style:{color:"#0066FF"}})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold cursor-pointer hover:underline",onClick:()=>n(`/student/booking/${s.id}`),children:s.lecturerName}),e.jsx("p",{className:"text-sm",style:{color:"#0066FF"},children:s.subject})]}),e.jsx(k,{style:I(s.status),children:s.status})]}),e.jsxs("div",{className:"space-y-1 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(h,{className:"w-4 h-4"}),new Date(s.date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4"}),s.time]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-4 h-4"}),"$",s.price]})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.paymentMethod==="VISA"?e.jsx(G,{className:"w-4 h-4",style:{color:"#0066FF"}}):e.jsx(J,{className:"w-4 h-4",style:{color:"#FFD700"}}),e.jsx("span",{className:"text-xs text-gray-600",children:s.paymentMethod==="VISA"?"Card Payment":"Manual Payment"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"outline",style:E(s.paymentStatus),children:s.paymentStatus}),!t&&e.jsxs(e.Fragment,{children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{const m=z(s),o=URL.createObjectURL(m),r=document.createElement("a");r.href=o,r.download=`booking-${s.id}.ics`,r.click(),URL.revokeObjectURL(o)},children:"Add to Calendar"}),e.jsx(c,{size:"sm",onClick:()=>S(s),children:"Reschedule"}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>n(`/chat/${s.id}`),children:"Chat"})]})]})]})]})]})})});return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#f8f9fa"},children:[e.jsx("div",{className:"sticky top-0 z-10 shadow-sm",style:{backgroundColor:"#0066FF"},children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(c,{variant:"ghost",size:"sm",onClick:()=>n("/student/dashboard"),className:"text-white hover:bg-white/20",children:e.jsx(O,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-white font-semibold",children:"My Bookings"})]})})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs(M,{defaultValue:"upcoming",className:"w-full",children:[e.jsxs(U,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(D,{value:"upcoming",children:["Upcoming (",x.length,")"]}),e.jsxs(D,{value:"past",children:["Past (",u.length,")"]})]}),e.jsx(F,{value:"upcoming",className:"space-y-4",children:x.length>0?x.map(s=>e.jsx(w,{booking:s},s.id)):e.jsx(g,{children:e.jsxs(N,{className:"p-8 text-center",children:[e.jsx(h,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No upcoming bookings"}),e.jsx(c,{className:"mt-4 text-white",style:{backgroundColor:"#0066FF"},onClick:()=>n("/student/dashboard"),children:"Browse Lecturers"})]})})}),e.jsx(F,{value:"past",className:"space-y-4",children:u.length>0?u.map(s=>e.jsx(w,{booking:s,isPast:!0},s.id)):e.jsx(g,{children:e.jsxs(N,{className:"p-8 text-center",children:[e.jsx(h,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No past bookings"})]})})})]})}),i&&e.jsx("div",{className:"fixed inset-0 bg-black/30 backdrop-blur-sm flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl max-w-lg w-full p-4",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",style:{color:"#0066FF"},children:["Reschedule: ",i.subject]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Choose a new available slot"}),e.jsx("div",{className:"max-h-64 overflow-auto border rounded-lg",children:b.length?e.jsx("ul",{children:b.map(s=>e.jsx("li",{children:e.jsxs("label",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 roofs",children:[e.jsx("input",{type:"radio",name:"slot",checked:(a==null?void 0:a.availabilityId)===s.availabilityId&&(a==null?void 0:a.slotId)===s.slotId,onChange:()=>p(s)}),e.jsxs("span",{children:[new Date(s.date).toLocaleDateString()," â€” ",s.time]})]})},`${s.availabilityId}-${s.slotId}`))}):e.jsx("div",{className:"p-3 text-sm text-gray-600",children:"No free slots available for this lecturer."})}),e.jsxs("div",{className:"flex justify-end gap-2 mt-3",children:[e.jsx(c,{variant:"outline",onClick:()=>{j(null),p(null)},children:"Cancel"}),e.jsx(c,{onClick:B,disabled:!a,children:"Confirm"})]})]})})]})}export{ce as default};
