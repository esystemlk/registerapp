import{u as Q,a as Z,r as a,j as e,B as l,t as N}from"./index-BqEl7Wkh.js";import{h as ee,i as se,j as m,l as te,p as ae,k as E,m as le}from"./db-DFw_BVXj.js";import{C as r,d as n,a as A,b as D}from"./card-Bdt5gLys.js";import{B as re}from"./badge-CukKXGJV.js";import{T as ne,a as ce,b as L,c as b}from"./tabs-DYtbYx4Q.js";import{H as ie}from"./HeaderBar-DQpC8sFT.js";import{C as de}from"./clock-BZjs3VgR.js";import{C as S,a as U}from"./circle-x-jIb-6Gpr.js";import{D as oe}from"./dollar-sign-_vtkuArg.js";import{F as O}from"./file-text-VWqbnJi2.js";import"./index-2-39tkqX.js";import"./index-khxpxN_7.js";import"./index-qGnbBy8k.js";import"./createLucideIcon-CsiBHQA2.js";function Le(){const{user:d,logout:xe}=Q(),o=Z(),[h,y]=a.useState([]),[V,w]=a.useState([]),[z,x]=a.useState([]),[p,G]=a.useState("ALL"),[g,_]=a.useState("ALL"),[F,H]=a.useState(""),[J,$]=a.useState([]),[v,q]=a.useState(""),[P,K]=a.useState(14);a.useEffect(()=>{(!d||!["ADMIN","SUPER_ADMIN","DEVELOPER"].includes(d.role))&&o("/login"),ee().then(y),se().then(s=>{w(s.filter(t=>!["SUPER_ADMIN","DEVELOPER"].includes(t.role)))}),m().then(x),te().then($)},[d,o]);const u=h.filter(s=>s.paymentStatus==="PENDING"&&s.paymentMethod==="RECEIPT"),j=h.filter(s=>s.paymentStatus==="APPROVED"),f=h.filter(s=>s.paymentStatus==="REJECTED"),R=async s=>{await E(s,{paymentStatus:"APPROVED",status:"CONFIRMED"}),y(t=>t.filter(i=>i.id!==s)),N.success("Payment approved and booking confirmed!"),m().then(x)},k=async s=>{await E(s,{paymentStatus:"REJECTED",status:"CANCELLED"}),y(t=>t.filter(i=>i.id!==s)),N.error("Payment rejected and booking cancelled."),m().then(x)},W=async(s,t)=>{["SUPER_ADMIN","DEVELOPER"].includes(t)||(await le(s,t),w(i=>i.map(c=>c.id===s?{...c,role:t}:c)),N.success("Role updated"))},X=async s=>{await E(s,{status:"CANCELLED"}),N.success("Booking cancelled"),m().then(x)},T=z.filter(s=>{var M,B,I;const t=p==="ALL"?!0:s.status===p||s.paymentStatus===p,i=g==="ALL"?!0:s.paymentMethod===g,c=F.trim().toLowerCase(),Y=!c||((M=s.studentName)==null?void 0:M.toLowerCase().includes(c))||((B=s.lecturerName)==null?void 0:B.toLowerCase().includes(c))||((I=s.subject)==null?void 0:I.toLowerCase().includes(c));return t&&i&&Y}),C=({booking:s})=>e.jsx(r,{children:e.jsx(n,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:s.studentName}),e.jsxs("p",{className:"text-sm",style:{color:"#0066FF"},children:[s.lecturerName," - ",s.subject]})]}),e.jsx(re,{style:{backgroundColor:"#FFD700",color:"#000"},children:s.paymentStatus})]}),e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Date:"})," ",new Date(s.date).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Time:"})," ",s.time]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Amount:"})," $",s.price]})]}),s.receiptUrl&&e.jsxs("div",{className:"p-3 rounded-lg",style:{backgroundColor:"#f9fafb"},children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(O,{className:"w-4 h-4",style:{color:"#0066FF"}}),e.jsx("span",{className:"text-gray-600",children:"Receipt uploaded"})]}),e.jsx("a",{href:s.receiptUrl,target:"_blank",rel:"noopener noreferrer",className:"text-xs mt-1 block",style:{color:"#0066FF"},children:"View receipt →"})]}),s.paymentStatus==="PENDING"&&e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs(l,{size:"sm",className:"text-white",style:{backgroundColor:"#10b981"},onClick:()=>R(s.id),children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),"Approve"]}),e.jsxs(l,{size:"sm",variant:"outline",style:{borderColor:"#ef4444",color:"#ef4444"},onClick:()=>k(s.id),children:[e.jsx(U,{className:"w-4 h-4 mr-1"}),"Reject"]})]})]})})});return e.jsxs("div",{className:"min-h-screen",style:{backgroundColor:"#f8f9fa"},children:[e.jsx(ie,{title:"Admin Portal",color:"#0066FF"}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-1",style:{color:"#0066FF"},children:["Welcome, ",d==null?void 0:d.name,"!"]}),e.jsx("p",{className:"text-gray-600",children:"Manage payments and bookings"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsx(r,{children:e.jsxs(n,{className:"p-4 text-center",children:[e.jsx(de,{className:"w-6 h-6 mx-auto mb-2",style:{color:"#FFD700"}}),e.jsx("p",{className:"text-2xl font-bold",children:u.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Pending"})]})}),e.jsx(r,{children:e.jsxs(n,{className:"p-4 text-center",children:[e.jsx(S,{className:"w-6 h-6 mx-auto mb-2",style:{color:"#10b981"}}),e.jsx("p",{className:"text-2xl font-bold",children:j.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Approved"})]})}),e.jsx(r,{children:e.jsxs(n,{className:"p-4 text-center",children:[e.jsx(oe,{className:"w-6 h-6 mx-auto mb-2",style:{color:"#0066FF"}}),e.jsx("p",{className:"text-2xl font-bold",children:h.length}),e.jsx("p",{className:"text-xs text-gray-600",children:"Total"})]})})]}),e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsx(l,{variant:"outline",onClick:()=>o("/admin/analytics"),children:"Analytics"}),e.jsx(l,{variant:"outline",onClick:()=>o("/admin/kyc"),children:"KYC Review"}),e.jsx(l,{variant:"outline",onClick:()=>o("/admin/support"),children:"Support Inbox"})]}),e.jsxs(r,{className:"mb-6",children:[e.jsx(A,{children:e.jsx(D,{style:{color:"#0066FF"},children:"Publish Availability"})}),e.jsxs(n,{className:"flex flex-wrap items-center gap-2",children:[e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:v,onChange:s=>q(s.target.value),children:[e.jsx("option",{value:"",children:"Select lecturer"}),J.map(s=>e.jsxs("option",{value:s.id,children:[s.name," — ",s.subject]},s.id))]}),e.jsx("input",{type:"number",min:1,max:60,className:"border rounded px-2 py-1 text-sm w-24",value:P,onChange:s=>K(parseInt(s.target.value||"14",10))}),e.jsx(l,{variant:"outline",onClick:async()=>{v&&await ae(v,Math.max(1,Math.min(60,P||14)))},children:"Publish"}),e.jsx("span",{className:"text-xs text-gray-500",children:"Generates dated availability from weekly template"})]})]}),e.jsxs(ne,{defaultValue:"pending",className:"w-full",children:[e.jsxs(ce,{className:"grid w-full grid-cols-3 mb-6",children:[e.jsxs(L,{value:"pending",children:["Pending (",u.length,")"]}),e.jsxs(L,{value:"approved",children:["Approved (",j.length,")"]}),e.jsxs(L,{value:"rejected",children:["Rejected (",f.length,")"]})]}),e.jsx(b,{value:"pending",className:"space-y-4",children:u.length>0?u.map(s=>e.jsx(C,{booking:s},s.id)):e.jsx(r,{children:e.jsxs(n,{className:"p-8 text-center",children:[e.jsx(O,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No pending payment approvals"})]})})}),e.jsx(b,{value:"approved",className:"space-y-4",children:j.length>0?j.map(s=>e.jsx(C,{booking:s},s.id)):e.jsx(r,{children:e.jsxs(n,{className:"p-8 text-center",children:[e.jsx(S,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No approved payments"})]})})}),e.jsx(b,{value:"rejected",className:"space-y-4",children:f.length>0?f.map(s=>e.jsx(C,{booking:s},s.id)):e.jsx(r,{children:e.jsxs(n,{className:"p-8 text-center",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-3 text-gray-400"}),e.jsx("p",{className:"text-gray-600",children:"No rejected payments"})]})})})]}),e.jsxs(r,{className:"mt-6",children:[e.jsx(A,{children:e.jsx(D,{style:{color:"#0066FF"},children:"All Bookings"})}),e.jsxs(n,{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[e.jsx("input",{className:"border rounded px-2 py-1 text-sm",placeholder:"Search student, lecturer, subject",value:F,onChange:s=>H(s.target.value)}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:p,onChange:s=>G(s.target.value),children:[e.jsx("option",{value:"ALL",children:"All statuses"}),e.jsx("option",{value:"CONFIRMED",children:"Confirmed"}),e.jsx("option",{value:"PENDING",children:"Pending"}),e.jsx("option",{value:"APPROVED",children:"Approved"}),e.jsx("option",{value:"REJECTED",children:"Rejected"}),e.jsx("option",{value:"CANCELLED",children:"Cancelled"})]}),e.jsxs("select",{className:"border rounded px-2 py-1 text-sm",value:g,onChange:s=>_(s.target.value),children:[e.jsx("option",{value:"ALL",children:"All methods"}),e.jsx("option",{value:"VISA",children:"Visa"}),e.jsx("option",{value:"RECEIPT",children:"Receipt"})]}),e.jsx(l,{variant:"outline",onClick:()=>m().then(x),children:"Refresh"})]}),e.jsxs("div",{className:"space-y-3",children:[T.map(s=>e.jsx("div",{className:"p-3 rounded-lg border",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:s.studentName}),e.jsxs("p",{className:"text-xs",style:{color:"#0066FF"},children:[s.lecturerName," • ",s.subject]}),e.jsxs("p",{className:"text-xs text-gray-600",children:[new Date(s.date).toLocaleDateString()," at ",s.time," • $",s.price]})]}),e.jsxs("div",{className:"flex gap-2",children:[s.paymentMethod==="RECEIPT"&&s.paymentStatus==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",onClick:()=>R(s.id),children:"Approve"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>k(s.id),children:"Reject"})]}),s.status!=="CANCELLED"&&e.jsx(l,{size:"sm",variant:"outline",onClick:()=>X(s.id),children:"Cancel"})]})]})},s.id)),T.length===0&&e.jsx("div",{className:"text-sm text-gray-600",children:"No bookings found"})]})]})]}),e.jsxs(r,{className:"mt-6",children:[e.jsx(A,{children:e.jsx(D,{style:{color:"#0066FF"},children:"User Management"})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3",children:V.map(s=>e.jsxs("div",{className:"p-3 rounded-lg border flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600",children:s.email})]}),e.jsxs("select",{className:"border rounded px-2 py-1 text-xs",value:s.role,onChange:t=>W(s.id,t.target.value),children:[e.jsx("option",{value:"STUDENT",children:"Student"}),e.jsx("option",{value:"LECTURER",children:"Lecturer"}),e.jsx("option",{value:"ADMIN",children:"Admin"})]})]},s.id))})})]})]})]})}export{Le as default};
